# 树状数组

[TOC]

## 一、前缀和与差分

1. 原数组：${a_1, a_2,a_3,....,a_n}$
2. 前缀和：$S_i=\sum_{k=1}^{k=i}{a_i}$，$a_i=S_i-S_{i-1}$
3. 差分数组：$X_i=a_i-a_{i-1}$
4. X 数组是 a 数组的差分数组，a 数组是 S 数组的差分数组
5. S 数组是 a 数组的前缀和数组，a 数组是 X 数组的前缀和数组
6. 前缀和数组以及差分数组，并没有增加信息，只是信息的另外一种表示形式
7. 前缀和数组用来优化区间和操作
8. 差分数组用来优化区间修改操作



### 问题1：原数组区间和操作

a 数组上的操作：$O(n)$

S 数组上的操作：$O(1)，S_i - S_{j-1}=a[j,i]区间和$



### 问题2：原数组区间元素修改（加法）

$a=\{a_1,a_2,a_3,a_4,a_5,a_6\}$

$X=\{X_1=a_1-a_0,X_2=a_2-a_1,X_3=a_3-a_2,X_4=a_4-a_3,X_5=a_5-a_4,X_6=a_6-a_5\}$



$\{a_1,a_2+d,a_3+d,a_4+d,a_5,a_6\}$

$X=\{X_1=a_1-a_0,X_2=a_2-a_1+d,X_3=a_3-a_2,X_4=a_4-a_3,X_5=a_5-a_4-d,X_6=a_6-a_5\}$



a 数组时间复杂度：$O(n)$

X 数组时间复杂度：$O(1)$

![image-20210112121557013](/Users/guanghu/Library/Application Support/typora-user-images/image-20210112121557013.png)



## 二、树状数组

1. lowbit 函数求数字 i，二进制表示中的最低1所在的位权
2. lowbit(x) = x & -x
3. 树状数组本质上是对前缀和数组的一种优化，主要体现在单点修改操作上
4. 前缀和查询 $O(logn)$，单点修改$O(logn)$
5. 相比于最普通的前缀和数组，查询方面变差，单点修改操作变好，综合时间复杂度变好
6. 查询的时候，向前统计，$i$ 的前一位 $i-lowbit(i)$
7. 修改的时候，向后修改，$i$ 的后一位 $i + lowbit(i)$



## 三、海贼 OJ-329-弱化的整数问题

### 引入差分数组

$a=\{a_1,a_2,a_3,a_4,a_5,a_6\}$

$X=\{X_1=a_1-a_0,X_2=a_2-a_1,X_3=a_3-a_2,X_4=a_4-a_3,X_5=a_5-a_4,X_6=a_6-a_5\}$



$\{a_1,a_2+d,a_3+d,a_4+d,a_5,a_6\}$

$X=\{X_1=a_1-a_0,X_2=a_2-a_1+d,X_3=a_3-a_2,X_4=a_4-a_3,X_5=a_5-a_4-d,X_6=a_6-a_5\}$



引入差分数组 X，将原数组 a 上的区间加操作，转换成 X 数组上的两次【单点操作】

对于查询原数组 a[i] 的值，等价于查询 X 数组前 i 位的【前缀和】



### 结论

由于，既要维护【前缀和】，又要进行【单点修改】，所以可以使用树状数组



![image-20210112121615328](/Users/guanghu/Library/Application Support/typora-user-images/image-20210112121615328.png)



## 四、海贼 OJ-330-加强的整数问题

### 引入差分数组

参考 HZOJ-329 的解法，主要为了维护原数组上的区间修改操作



### 原数组上的区间和问题转化

$a=\{a_1,a_2,a_3,a_4,a_5,a_6\}$

$X=\{X_1=a_1-a_0,X_2=a_2-a_1,X_3=a_3-a_2,X_4=a_4-a_3,X_5=a_5-a_4,X_6=a_6-a_5\}$

$Query(l, r) = S(r) - S(l - 1)$，重点分析 S 怎么求，会求 S，万事大吉

$S_i= \sum_{k=1}^{i}\sum_{y=1}^{k}{X_y} = \sum_{k=1}{i}{(i + 1)X_k-k*X_k}=(i + 1)\sum_{k=1}^{i}{X_k-\sum_{k=1}^{i}k*X_k}$

设$Y_i = i \times X_i$

$S_i=(i + 1)\sum_{k=1}^{i}{X_k-\sum_{k=1}^{i}{Y_k}}$



### 结论

$S_i$ 可以通过维护 X 与 Y 两个序列的前缀和得到

所以可以通过维护两个与差分数组 X 相关的前缀和数组，从而得到原数组 a 的前缀和值

需要维护两个：树状数组



![image-20210112121626383](/Users/guanghu/Library/Application Support/typora-user-images/image-20210112121626383.png)