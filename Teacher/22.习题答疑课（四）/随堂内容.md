# 习题答疑课（四）

[TOC]

## 一、HZOJ-328-楼兰图腾

### 1、30分程序改 BUG

1. 数据类型从 $int$ 改成 $long\ long$

    

### 2、60分程序改 BUG

1. 数据类型从 $int$ 改成 $long\ long$



## 二、HZOJ-224-复合线段树

### 1、解题思路

1. 因为要支持区间操作，所以要用到线段树的懒标记技巧
2. 有两种区间修改操作，乘法与加法
3. $a\times(s + b) = a \times s + a \times b$，可知乘法操作的时候，需要同时修改区间和值与加法懒标记
4. 加法懒标记只需要单独修改加法懒标记即可
5. 懒标记更新技巧：先下沉乘法懒标记，再下沉加法懒标记

![image-20210130215543216](/Users/guanghu/Library/Application Support/typora-user-images/image-20210130215543216.png)

### 2、0分程序改 BUG

1. 主要 BUG，超过内存限制
2. 原因分析：程序中，将懒标记改成了记录具体的操作序列，所以使得线段树节点空间激增，超过内存限制
3. 在不修改懒标记技巧的情况下，无法满分通过程序
4. **思考：**如果把线段树的节点修改成动态申请的，说不定会通过空间限制。



### 3、10分程序改 BUG

1. 懒标记更新方式严重错误，源程序中将懒标记更新到了整棵子树中。
2. **修改1：**懒标记从父节点，只下沉到直接子节点处
3. **修改2：**标记下沉时，要先将乘法标记下沉，再将加法标记下沉
4. **修改3：**该 $\%p$ 的地方就 $\%p$



### 4、50分程序改 BUG

1. 下沉乘法懒标记时出错，应该同时修改加法懒标记
2. **修改1：**将乘法标记下沉与加法标记下沉分成两个函数分别实现
3. **修改2：**将数据类型改成 $long\ long$



## 三、HZOJ-52-古老的打字机

### 1、40分程序改 BUG

1. 状态转移过程，采用了最朴素的状态转移方式，时间效率极差
2. 没有采用斜率优化的转移技巧



### 2、40分程序改 BUG

1. 程序过程中需要求前缀和，值范围超过了整型表示范围，将 $int$ 改成 $long\ long$ 即可